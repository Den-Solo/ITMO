Пещеры представим в виде вершина дерева, а соединения в виде ребер.
Воспользуемся heavy-light композицией, чтобы найти в дереве пути с попарно разными наборами ребер. 
Для каждого такого пути заведем дерево отрезков, которое будет поддерживать максимальное значение радиации на каждом таком пути.

Для каждого входящего запроса на поиск максимума нужно просчитать максимальное значение вершины на пути между вершинами v1,v2. 
Добиваемся того, чтобы одна из вершина оказалось предком другой.
 Для этого
1) берем одну из вершин v1 (например), 
2) определяем вершину v, являющуюся корнем heavy-light пути для v1 (v = hl_roots[path_idx[v1]]),
3) Если v не является прямым предком v2, то поднимаем v1 наверх в другой h-l путь, попутно узнав максимум на пути от v до v1 (в рамках одного пути - это запрос к дереву отрезков)
v1 = parent[v];
4) когда корень пути, где содержится v1 станет предком v2, обмениваем значения v1 и v2 и повторяем пункты 1 - 3. 
В результате выйдет, что обе вершины v1 и v2 окажутся в одном пути.
(сначала первая поднимется до подходящей, затем вторая поднимется до нее)
в процессе мы будем знать максимум на пройденных вершинах.

Возвращаем максимум из прежде вычисленного максимума и максимума на пути от новых v1, v2.
