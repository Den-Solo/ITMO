1) начальные значения зарядов частиц храним в отдельном массиве и не меняем в процессе. 
2) прежде чем начинать отвечать на запросы, найдем для каждого индекса из диапазона 1..n все его делители умножением и запишем в массив (это быстрее, чем заниматься делением каждого входящего числа)
3) Для хранения диапазонов измененных значений воспользуемся деревом фенвика.
Известно, что если i -й элемент изменить на какое-то число, то префиксные суммы до любого элемента, начиная с i - го увеличатся на это число, поэтому, вместо того чтобы держать просто массив измененных зарядов для каждого числа и изменять его за линейное время относительно количества делителей, можно всего за два изменения в дереве фенвика сделать ответы для чисел в изменном диапазоне (left, right)новыми, все что нужно - элемент left в дереве фенвика увеличить на val, а элемент (right + 1) уменьшить на val. Тогда запрос префиксной суммы от любого из делителей в диапазоне (left, right) вернет новое значение, а чтобы числа правее диапазона не возросли и было произведено вычитание.